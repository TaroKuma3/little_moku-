<h1>Mypage#index</h1>
<h1><%= @user.name%>さんのマイページ</h1>
<ul>
  <li>
    <%= link_to("MOKUる", new_user_moku_path(@user))%>
  </li>
  <li>
    <%= link_to("これまでのMOKU一覧へ(カレンダーのメガネから)", user_mokus_path(@user))%>
  </li>
  <li>
    <%= link_to("MOKUタグ一覧へ", user_moku_type_index_path(@user))%>
  </li>
  <li>
    <%= link_to("成果物一覧へ（王冠から）", user_work_index_path(@user))%>
  </li>
  <li>
    <%= link_to("ブックマーク一覧へ", user_book_marks_path(@user))%>
  </li>
</ul>

<ul>
  <li>
    PICK UP MOKU
    <% @works_random.each do |work_random| %>
      <ul>
        <li>
        <% work = Work.find_by(id: work_random.id)%>
          <%#= link_to(work_random.title, "users/#{@user.id}/works/#{work.id}/public") %>
          <% if work.user_id == current_user.id%>
            <%= link_to(work_random.title, user_work_path(@user, work)) %>
          <% else %>
            <%= link_to(work_random.title, "/users/#{work.user_id}/works/#{work.id}/public") %>
          <% end %>
        </li>
      </ul>
    <% end %>
  </li>
</ul>

<h4>MOKU JUST NOW</h4>

<ul id="justNowUl"></ul>

<script>

  function getJustNowDatas() {
      $.ajax({
          type: 'get',
          url: '/ajax/justnow.json'
      }).done(function (response, status) {

          $('#justNowUl').empty() //justNowUlの中身を空っぽに

          const mokus = response //responseは↑の第一引数。ブラウザから返ってきたデーター
          console.log(mokus)

          for (let i = 0; i < mokus.length; i++) { //変数iを定義　mokusの要素の数より小さいうちはインクリメント
              const moku = mokus[i] //定数mokuを定義　mokusに入っている要素のi番目を取得
              console.log(moku.id, moku.moku_type_id)
              // let created_time = moment(moku.created_at).fromNow()
              const liElement = "<li>" + moku.created_at + "   " + moku.user.name + "さんが" + moku.moku_type.name + "でMOKUを開始しました！" + "</li>" //定数liElementを定義　moku.idをリスト形式で出力
              $('#justNowUl').append(liElement) //justNowUlに対してliElementを追加　
          }
      })
  }

  $(document).ready(function () {
      setInterval(getJustNowDatas, 5000)
      // $('#justNowButton').on('click', function () {
      // })

  })

</script>

<h4><%= "#{@user.name}さんのMOKUアイテム" %></h4>
<% if @user.items.empty? %>
  <h5>☁︎画面下部の「個人設定」から、使用する道具を登録しよう！</h5>
<% else %>
  <%= simple_format(@user.items) %>
<% end %>

<h4>自己紹介</h4>
<% if @user.introduce.empty? %>
　<h5>︎︎︎︎☁︎画面下部の「個人設定」から、自己紹介を登録しよう！</h5>
<% else %>
  <%= simple_format(@user.introduce) %>
<% end %>

<h4>アカウントの公開表/非公開</h4>
<%= public_to_s(@user.public) %>
<% if @user.admin? %>
<%# booleanを定義している場合、？のメソッドで　tureか？と聞く。
本来聞くメソッドが必ず必要で、今回user.rbに定義はしたんだけど、実は定義しないでもOK
必ず必要だからこそ、もし定義してない場合NoMethodErrorがでて、その時に
booleanのメソッドがないなら生やしてやるよ、とRailsが勝手に判定メソッドをその場で作ってくれるため。
作ってくれるなら書かなくていいよね、という感じでuser.rbのメソッドはコメントアウトした状態。
ちなみにここのif @user.admin?の?は実はあってもなくてもいいけれど、あった方がいいよね、と %>
<h2>管理者メニュー</h2>
<ul>
  <li>
    <%= link_to("FAQの追加", faqs_new_path )%>
  </li>
  <li>
    <%= link_to("FAQの編集・削除", faqs_path )%>
  </li>
</ul>
<% end %>

<h1>カレンダー</h1>

<%= month_calendar(attribute: :created_at, events: @mokus) do |date, mokus| %>
  <%= date %><br>
  <% mokus.each do |moku| %>
      <% moku_type = MokuType.find(moku.moku_type_id)%>
        <%= link_to(moku_type.name, user_moku_path(moku.user_id, moku.id)) %><br>
    <% end %>
<% end %>

<h3><%= link_to("個人設定", "/accounts/#{current_user.id}")%></h3>
<h3><%= link_to("よくある質問",faqs_path) %></h3>
